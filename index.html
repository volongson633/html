<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng H·ªó Tr·ª£ Giao Ti·∫øp</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-4 max-w-6xl">
        <h1 class="text-4xl font-bold text-center mb-8 text-blue-600">H·ªá Th·ªëng H·ªó Tr·ª£ Giao Ti·∫øp</h1>
        
        <!-- B∆∞·ªõc 1: Nh·∫≠n d·∫°ng ng∆∞·ªùi d√πng -->
        <div id="step1" class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4">B∆∞·ªõc 1: Nh·∫≠n d·∫°ng ng∆∞·ªùi A</h2>
            <button id="voicePrompt" class="bg-blue-500 text-white px-6 py-3 rounded-lg text-xl mb-4">üîä B·∫Øt ƒë·∫ßu (Gi·ªçng n√≥i)</button>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <label class="flex items-center text-xl">
                    <input type="checkbox" id="blindA" class="mr-3 w-6 h-6"> M√π
                </label>
                <label class="flex items-center text-xl">
                    <input type="checkbox" id="muteA" class="mr-3 w-6 h-6"> C√¢m
                </label>
                <label class="flex items-center text-xl">
                    <input type="checkbox" id="deafA" class="mr-3 w-6 h-6"> ƒêi·∫øc
                </label>
            </div>
            <button id="confirmA" class="bg-green-500 text-white px-6 py-3 rounded-lg text-xl w-full">X√°c nh·∫≠n ng∆∞·ªùi A</button>
        </div>

        <!-- B∆∞·ªõc 2: Ch·ªçn ng∆∞·ªùi B -->
        <div id="step2" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
            <h2 class="text-2xl font-bold mb-4">B∆∞·ªõc 2: Ch·ªçn ng∆∞·ªùi B</h2>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <label class="flex items-center text-xl">
                    <input type="checkbox" id="blindB" class="mr-3 w-6 h-6"> M√π
                </label>
                <label class="flex items-center text-xl">
                    <input type="checkbox" id="muteB" class="mr-3 w-6 h-6"> C√¢m
                </label>
                <label class="flex items-center text-xl">
                    <input type="checkbox" id="deafB" class="mr-3 w-6 h-6"> ƒêi·∫øc
                </label>
            </div>
            <button id="confirmB" class="bg-green-500 text-white px-6 py-3 rounded-lg text-xl w-full">X√°c nh·∫≠n ng∆∞·ªùi B</button>
        </div>

        <!-- B∆∞·ªõc 3: K·∫øt qu·∫£ ph√¢n t√≠ch -->
        <div id="step3" class="bg-white rounded-lg shadow-lg p-6 hidden">
            <h2 class="text-2xl font-bold mb-4">B∆∞·ªõc 3: Ph√¢n t√≠ch giao ti·∫øp</h2>
            
            <div class="grid grid-cols-2 gap-6 mb-6">
                <!-- Ng∆∞·ªùi A -->
                <div class="border-2 border-blue-300 rounded-lg p-4">
                    <h3 class="text-xl font-bold mb-2 text-blue-600">Ng∆∞·ªùi A</h3>
                    <div id="personAInfo" class="text-lg"></div>
                </div>
                
                <!-- Ng∆∞·ªùi B -->
                <div class="border-2 border-green-300 rounded-lg p-4">
                    <h3 class="text-xl font-bold mb-2 text-green-600">Ng∆∞·ªùi B</h3>
                    <div id="personBInfo" class="text-lg"></div>
                </div>
            </div>

            <!-- Khu v·ª±c giao ti·∫øp -->
            <div class="bg-yellow-50 border-2 border-yellow-400 rounded-lg p-6">
                <h3 class="text-2xl font-bold mb-4">K√™nh giao ti·∫øp kh·∫£ d·ª•ng</h3>
                <div id="warningMsg" class="bg-red-100 border-2 border-red-500 text-red-700 p-4 rounded-lg mb-4 text-xl hidden"></div>
                <div id="communicationChannels" class="space-y-4"></div>
            </div>

            <!-- Demo giao ti·∫øp -->
            <div class="mt-6 bg-blue-50 border-2 border-blue-400 rounded-lg p-6">
                <h3 class="text-2xl font-bold mb-4">Demo giao ti·∫øp th·ª±c t·∫ø</h3>
                
                <!-- Text to Audio -->
                <div class="mb-4">
                    <label class="block text-lg font-bold mb-2">Text ‚Üí Audio:</label>
                    <input type="text" id="textInput" placeholder="Nh·∫≠p vƒÉn b·∫£n..." class="w-full p-3 border-2 rounded-lg text-lg mb-2">
                    <button id="speakBtn" class="bg-purple-500 text-white px-6 py-2 rounded-lg text-lg">üîä Ph√°t √¢m</button>
                </div>

                <!-- Audio to Text -->
                <div class="mb-4">
                    <label class="block text-lg font-bold mb-2">Audio ‚Üí Text:</label>
                    <button id="listenBtn" class="bg-orange-500 text-white px-6 py-2 rounded-lg text-lg mr-2">üé§ L·∫Øng nghe</button>
                    <span id="listeningStatus" class="text-lg"></span>
                    <div id="recognizedText" class="mt-2 p-3 bg-white border-2 rounded-lg text-lg min-h-12"></div>
                </div>

                <!-- Text to Sign -->
                <div class="mb-4">
                    <label class="block text-lg font-bold mb-2">Text ‚Üí Sign (gi·∫£ l·∫≠p):</label>
                    <input type="text" id="signInput" placeholder="Nh·∫≠p vƒÉn b·∫£n..." class="w-full p-3 border-2 rounded-lg text-lg mb-2">
                    <button id="signBtn" class="bg-teal-500 text-white px-6 py-2 rounded-lg text-lg">ü§ü Hi·ªÉn th·ªã ng√¥n ng·ªØ k√Ω hi·ªáu</button>
                    <div id="signOutput" class="mt-2 p-6 bg-white border-2 rounded-lg text-6xl text-center min-h-24"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const userProfiles = {
            blind: { TEXT: 0, AUDIO: 1, SIGN: 0 },
            mute: { TEXT: 1, AUDIO: 1, SIGN: 1 },
            deaf: { TEXT: 1, AUDIO: 0, SIGN: 1 },
            'blind+mute': { TEXT: 0, AUDIO: 1, SIGN: 0 },
            'blind+deaf': { TEXT: 0, AUDIO: 0, SIGN: 0 },
            'mute+deaf': { TEXT: 1, AUDIO: 0, SIGN: 1 },
            'blind+mute+deaf': { TEXT: 0, AUDIO: 0, SIGN: 0 }
        };

        let personA = null;
        let personB = null;
        let synthesis = window.speechSynthesis;
        let recognition = null;

        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'vi-VN';
            recognition.continuous = false;
        }

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'vi-VN';
            synthesis.speak(utterance);
        }

        document.getElementById('voicePrompt').addEventListener('click', () => {
            speak('B·∫°n c√≥ v·∫•n ƒë·ªÅ g√¨ v·ªÅ giao ti·∫øp? H√£y n√≥i ho·∫∑c ch·ªçn th·ªß c√¥ng.');
        });

        function getProfileKey(blind, mute, deaf) {
            const conditions = [];
            if (blind) conditions.push('blind');
            if (mute) conditions.push('mute');
            if (deaf) conditions.push('deaf');
            return conditions.join('+') || 'normal';
        }

        function getProfile(blind, mute, deaf) {
            const key = getProfileKey(blind, mute, deaf);
            return userProfiles[key] || { TEXT: 1, AUDIO: 1, SIGN: 1 };
        }

        document.getElementById('confirmA').addEventListener('click', () => {
            const blind = document.getElementById('blindA').checked;
            const mute = document.getElementById('muteA').checked;
            const deaf = document.getElementById('deafA').checked;
            
            personA = {
                blind, mute, deaf,
                profile: getProfile(blind, mute, deaf),
                label: getProfileKey(blind, mute, deaf) || 'B√¨nh th∆∞·ªùng'
            };

            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
            speak('ƒê√£ x√°c nh·∫≠n ng∆∞·ªùi A. H√£y ch·ªçn th√¥ng tin ng∆∞·ªùi B.');
        });

        document.getElementById('confirmB').addEventListener('click', () => {
            const blind = document.getElementById('blindB').checked;
            const mute = document.getElementById('muteB').checked;
            const deaf = document.getElementById('deafB').checked;
            
            personB = {
                blind, mute, deaf,
                profile: getProfile(blind, mute, deaf),
                label: getProfileKey(blind, mute, deaf) || 'B√¨nh th∆∞·ªùng'
            };

            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.remove('hidden');
            analyzeComm();
        });

        function analyzeComm() {
            document.getElementById('personAInfo').innerHTML = `
                <p><strong>Lo·∫°i:</strong> ${personA.label}</p>
                <p><strong>TEXT:</strong> ${personA.profile.TEXT ? '‚úì' : '‚úó'}</p>
                <p><strong>AUDIO:</strong> ${personA.profile.AUDIO ? '‚úì' : '‚úó'}</p>
                <p><strong>SIGN:</strong> ${personA.profile.SIGN ? '‚úì' : '‚úó'}</p>
            `;

            document.getElementById('personBInfo').innerHTML = `
                <p><strong>Lo·∫°i:</strong> ${personB.label}</p>
                <p><strong>TEXT:</strong> ${personB.profile.TEXT ? '‚úì' : '‚úó'}</p>
                <p><strong>AUDIO:</strong> ${personB.profile.AUDIO ? '‚úì' : '‚úó'}</p>
                <p><strong>SIGN:</strong> ${personB.profile.SIGN ? '‚úì' : '‚úó'}</p>
            `;

            const channels = [];
            const inputModes = ['TEXT', 'AUDIO', 'SIGN'];
            const outputModes = ['TEXT', 'AUDIO', 'SIGN'];

            inputModes.forEach(input => {
                if (!personA.mute || input !== 'AUDIO') {
                    outputModes.forEach(output => {
                        if (personB.profile[output] === 1) {
                            channels.push({ input, output });
                        }
                    });
                }
            });

            const channelsDiv = document.getElementById('communicationChannels');
            const warningDiv = document.getElementById('warningMsg');

            if (channels.length === 0) {
                warningDiv.classList.remove('hidden');
                warningDiv.innerHTML = '‚ö†Ô∏è <strong>C·∫¶N NG∆Ø·ªúI H·ªñ TR·ª¢ TRUNG GIAN</strong><br>Kh√¥ng c√≥ k√™nh giao ti·∫øp tr·ª±c ti·∫øp kh·∫£ d·ª•ng.';
                channelsDiv.innerHTML = '';
            } else {
                warningDiv.classList.add('hidden');
                let html = '<div class="space-y-2">';
                channels.forEach((ch, idx) => {
                    const recommended = idx === 0 ? ' bg-green-200 border-green-600' : ' bg-white';
                    const badge = idx === 0 ? ' <span class="bg-green-600 text-white px-2 py-1 rounded text-sm">Khuy·∫øn ngh·ªã</span>' : '';
                    html += `<div class="border-2 p-4 rounded-lg${recommended}">
                        <strong class="text-xl">A (${ch.input}) ‚Üí TEXT ‚Üí B (${ch.output})</strong>${badge}
                    </div>`;
                });
                html += '</div>';
                channelsDiv.innerHTML = html;
            }
        }

        // Demo Text to Audio
        document.getElementById('speakBtn').addEventListener('click', () => {
            const text = document.getElementById('textInput').value;
            if (text) speak(text);
        });

        // Demo Audio to Text
        document.getElementById('listenBtn').addEventListener('click', () => {
            if (!recognition) {
                alert('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Speech Recognition');
                return;
            }
            document.getElementById('listeningStatus').textContent = 'üé§ ƒêang l·∫Øng nghe...';
            recognition.start();
        });

        if (recognition) {
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('recognizedText').textContent = transcript;
                document.getElementById('listeningStatus').textContent = '';
            };
            recognition.onerror = () => {
                document.getElementById('listeningStatus').textContent = '‚ùå L·ªói';
            };
        }

        // Demo Text to Sign
        const signMap = {
            'xin ch√†o': 'üëã',
            'c·∫£m ∆°n': 'üôè',
            't·∫°m bi·ªát': 'üëã‚úã',
            'v√¢ng': 'üëç',
            'kh√¥ng': 'üëé',
            'y√™u': '‚ù§Ô∏è',
            'ƒÉn': 'üçΩÔ∏è',
            'u·ªëng': 'ü•§',
            'nh√†': 'üè†',
            'b·ªánh vi·ªán': 'üè•'
        };

        document.getElementById('signBtn').addEventListener('click', () => {
            const text = document.getElementById('signInput').value.toLowerCase();
            let output = '';
            for (let word in signMap) {
                if (text.includes(word)) {
                    output += signMap[word] + ' ';
                }
            }
            if (!output) {
                output = text.split('').map(c => {
                    if (c === ' ') return 'üëå';
                    return String.fromCodePoint(127462 + c.charCodeAt(0) - 97);
                }).join(' ');
            }
            document.getElementById('signOutput').textContent = output || 'ü§∑';
        });
    </script>
</body>
</html>